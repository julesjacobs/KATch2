<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KATch2 NetKAT Analyzer</title>
    <link rel="icon" type="image/png" href="assets/favicon.png">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            margin: 0;
            padding: 20px;
            background-color: #f4f6f8;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 850px;
            display: flex;
            flex-direction: column;
        }
        h1 {
            color: #000;
            text-align: center;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        h1 img {
            vertical-align: middle;
            margin-right: -50px;
            margin-bottom: -10px;
            width: 100px;
            height: 100px;
        }
        .initial-message {
            color: #555;
            text-align: center;
            margin-bottom: 25px;
            font-size: 0.95em;
        }

        .github-link {
            text-align: center;
            margin-top: 10px;
            padding-top: 20px;
        }
        .github-link a {
            text-decoration: none;
            color: #333;
            font-size: 0.9em;
        }
        .github-link svg {
            width: 20px;
            height: 20px;
            vertical-align: middle;
            margin-right: 5px;
            fill: currentColor;
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>
            <img src="assets/katch2-logo-black.webp" alt="KATch2 Logo">
            KATch<sup style="font-size: 0.6em">2</sup> NetKAT Tutorial
        </h1>
        
        <p>This tutorial will guide you through the basics of NetKAT.</p>

        <h2>Packets and Variables</h2>
        <p>In NetKAT, a <strong>packet</strong> is represented as a sequence (or vector) of bits. We use variables like <code>x0</code>, <code>x1</code>, <code>x2</code>, and so on, to refer to these bits.</p>
        <p>For example, if a packet is <code>[1, 0, 1]</code>, then:</p>
        <ul>
            <li><code>x0</code> would be 1</li>
            <li><code>x1</code> would be 0</li>
            <li><code>x2</code> would be 1</li>
        </ul>

        <h2>Tests (Packet Filters)</h2>
        <p>Tests are conditions that check the value of a packet bit. They act as filters: if the condition is true, the packet passes through; otherwise, it is dropped (or "filtered out").</p>
        <p>For example, <code>x0 == 1</code> tests if the first bit of the packet is 1. If it is, the packet continues. If <code>x0</code> is 0, the packet is dropped.</p>
        <p>Here's an example. Try changing the packet bits in the "Input Packet" field and see how the trace changes based on the test:</p>
        <netkat>x0 == 1</netkat>
        <p>You can also test for equality to 0, like <code>x3 == 0</code>.</p>

        <netkat exercise="Write a test that only allows packets where x1 is 0" id="exercise1">x1 == 0</netkat>

        Note that the examples displayed are as wide as the largest bit mentioned in the program.

        <h2>Sequential Composition</h2>
        <p>Sequential composition, denoted by a semicolon <code>;</code>, combines two NetKAT expressions by executing them one after the other. The packet output by the first expression becomes the input to the second.</p>
        <p>For example, <code>x0 == 1; x1 == 0</code> first tests if <code>x0</code> is 1. If true, that packet is then passed to <code>x1 == 0</code>, which tests if its second bit is 0.</p>
        <netkat>x0 == 1; x1 == 0</netkat>

        <p></p>

        <netkat exercise="Write a policy that tests x0 == 1, then tests x2 == 0" id="exercise2">x0 == 1; x2 == 0</netkat>

        <h2>Assignments</h2>
        <p>Assignments modify the packet's bits. The expression <code>x0 := 1</code> sets the first bit of the packet to 1, regardless of its previous value. <code>x2 := 0</code> sets the third bit to 0.</p>
        <netkat>x0 := 1; x2 := 0</netkat>
        <p>Observe how the packet bits change after the assignments in the trace.</p>

        <netkat exercise="Set x0 to 0 and x2 to 1" id="exercise3">x0 := 0; x2 := 1</netkat>

        <h2>Choice (Union)</h2>
        <p>Choice, denoted by a plus sign <code>+</code>, represents a non-deterministic selection between two NetKAT expressions. The network can choose to follow either path.</p>
        <p>For example, <code>x0 := 1 + x1 := 1</code> means the policy can either set <code>x0</code> to 1 OR set <code>x1</code> to 1. The analyzer will explore both possibilities.</p>
        <netkat>x0 := 1 + x1 := 1</netkat>
        <p>You'll see multiple paths in the trace if the input packet allows for both choices to be taken, or if the choices lead to different packet states.</p>

        <netkat exercise="Write a policy that either tests x0 == 1 or assigns x1 := 0" id="exercise4">x0 == 1 + x1 := 0</netkat>

        <h2>Encoding If-Then-Else</h2>
        <p>NetKAT can express conditional logic (if-then-else) by combining tests, assignments, and choice.</p>
        <p>The general pattern for "if C then P1 else P2" is: <code>(C; P1) + (not C; P2)</code>.</p>
        <p>For example, to say "if x0 is 1, then set x1 to 1, otherwise set x1 to 0":</p>
        <netkat>(x0 == 1; x1 := 1) + (x0 == 0; x1 := 0)</netkat>
        <p>Let's break this down:</p>
        <ul>
            <li><code>(x0 == 1; x1 := 1)</code>: If <code>x0</code> is 1, then set <code>x1</code> to 1.</li>
            <li><code>(x0 == 0; x1 := 0)</code>: If <code>x0</code> is 0 (the 'else' condition), then set <code>x1</code> to 0.</li>
            <li>The <code>+</code> combines these, so if the packet has <code>x0=1</code> the first branch is taken, and if <code>x0=0</code> the second is.</li>
        </ul>
        <p>Try an input packet where <code>x0</code> is 1, and then one where <code>x0</code> is 0.</p>

        <netkat exercise="If x1 == 0 then set x0 := 1, else set x0 := 0" id="exercise5">(x1 == 0; x0 := 1) + (x1 == 1; x0 := 0)</netkat>


        <h2>Dup (Logging)</h2>
        <p>The <code>dup</code> keyword is a special NetKAT operator that records the current packet state to the trace output without modifying it. This is extremely useful for observing the packet state at various points in your NetKAT expression.</p>
        <p>Example: Set <code>x0</code> to 1, log the packet, then set <code>x1</code> to 1.</p>
        <netkat>x0 := 1; dup</netkat>
        <p>You'll see an entry in the trace specifically for the <code>dup</code> operation, showing the packet state after <code>x0 := 1</code> but before <code>x1 := 1</code>.</p>

        <netkat exercise="Set x1 to 1, log with dup, then set x2 to 0" id="exercise7">x1 := 1; dup; x2 := 0</netkat>

        <h2>Iteration (Kleene Star)</h2>
        <p>Iteration, denoted by an asterisk <code>*</code> (Kleene star) after an expression <code>e</code> (i.e., <code>e*</code>), allows an expression to be executed zero or more times.</p>
        <p>For example, this program uses <code>dup</code> inside an iteration to see the packet at each step of a loop:</p>
        <netkat>(((x0 == 0; x0 := 1) + (x0 == 1; x0 := 0)); dup)*; x1 := 1</netkat>
        <p>This will show multiple paths in the trace, corresponding to 0, 1, 2, etc., iterations, up to a limit defined by the analyzer to prevent infinite loops in the visualization.
        The program above will flip the first bit of the packet, then flip it back, then flip it again, etc., and finally output the packet after setting the second bit to 1.
        </p>

        <netkat exercise="Write an iteration that nondeterministically modifies x0 in a loop." id="exercise6">((x0 := 0 + x0 := 1); dup)*</netkat>

        <h2>Examples & Practice</h2>
        <p>Click examples on the left to load them into the practice editor, or write your own expressions:</p>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
            <div>
                <h3>Examples (click to load):</h3>
                
                <h4>Basic Operations:</h4>
                <netkat target="practice-editor">x0 := 1</netkat>
                <netkat target="practice-editor">x1 == 0</netkat>
                <netkat target="practice-editor">x0 := 1; x1 := 0</netkat>
                
                <h4>Choice Operations:</h4>
                <netkat target="practice-editor">x0 := 1 + x1 := 1</netkat>
                <netkat target="practice-editor">(x0 == 1; x1 := 1) + x1 := 0</netkat>
                
                <h4>Iterations:</h4>
                <netkat target="practice-editor">(x0 == 0; x0 := 1)*</netkat>
                <netkat target="practice-editor">((x0 == 0; x0 := 1); dup)*</netkat>
                
                <h4>Complex Policies:</h4>
                <netkat target="practice-editor" lines="3">// Bit flipper with logging
(x0 == 0; x0 := 1 + x0 == 1; x0 := 0);
dup; x1 := 1</netkat>

                <netkat target="practice-editor" lines="4">// Conditional assignment chain
x0 == 1;
(x1 == 0; x2 := 1 + x1 == 1; x2 := 0);
dup</netkat>
            </div>
            
            <div>
                <h3>Practice Editor</h3>
                <h4>Click examples on the left to load them:</h4>
                <netkat id="practice-editor" lines="8" show-line-numbers>

</netkat>
            </div>
        </div>

        <h2>Exercises & Analysis</h2>
        <p>Click exercises on the left to load them into the analysis editor with equivalence checking:</p>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
            <div>
                <h3>Additional Exercises:</h3>
                
                <netkat exercise="Create a bit flipper: if x0 is 0 set it to 1, if x0 is 1 set it to 0" target="analysis-editor">(x0 == 0; x0 := 1) + (x0 == 1; x0 := 0)</netkat>
                
                <netkat exercise="Write a policy that copies x0 to x1" target="analysis-editor">(x0 == 1; x1 := 1) + (x0 == 0; x1 := 0)</netkat>
                
                <netkat exercise="Create a policy that accepts packets only if both x0 and x1 are 1" target="analysis-editor">x0 == 1; x1 == 1</netkat>

                <netkat exercise="Write a policy that swaps x0 and x1" target="analysis-editor">
                    (x0 == 0; x1 == 1; x0 := 1; x1 := 0) + 
                    (x0 == 1; x1 == 0; x0 := 0; x1 := 1)
                </netkat>
            </div>
            
            <div>
                <p></p>
                <h3>Exercise Editor:</h3>
                <netkat id="analysis-editor" lines="8" show-line-numbers>// Click an exercise to load it

</netkat>
            </div>
        </div>

        <p>This concludes the basic NetKAT tutorial. Experiment with these constructs to build more complex network policies!</p>
        
    </div>

    <div class="github-link">
        <a href="https://github.com/julesjacobs/KATch2" target="_blank" rel="noopener noreferrer">
            <svg viewBox="0 0 16 16" version="1.1" aria-hidden="true">
                <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
            </svg>
            View KATch2 source on GitHub
        </a>
    </div>

    <!-- Include the new KATch2 UI library -->
    <script type="module" src="katch2ui/katch2-editor.js"></script>
</body>
</html> 